{"version":3,"file":"reactivity.global.js","sources":["../src/effect.ts","../../shared/src/index.ts","../src/reactive.ts"],"sourcesContent":["\r\n\r\n\r\nexport function effect(){\r\n    \r\n}","export function isObject(value: unknown): value is Record<any, any> {\r\n    return typeof value === 'object' && value !== null\r\n}","import { isObject } from \"@vue/shared\"\r\n\r\n\r\nconst enum ReactiveFlags {\r\n    IS_REACTIVE = '__v_isReactive'\r\n}\r\nconst mutableHandlers: ProxyHandler<Record<any, any>> = {\r\n    get(target, key, recevier) { // 代理对象的本身\r\n        if (key === ReactiveFlags.IS_REACTIVE) {\r\n            return true;\r\n        }\r\n        // 这里取值了， 可以收集他在哪个effect中\r\n        const res = Reflect.get(target, key, recevier); // target[key]\r\n        return res;\r\n    },\r\n    set(target, key, value, recevier) {\r\n\r\n        // 如果改变值了， 可以在这里触发effect更新\r\n        const res = Reflect.set(target, key, value, recevier); // target[key] = value\r\n        return res;\r\n    }\r\n}\r\n// map和weakMap的区别\r\nconst reactiveMap = new WeakMap(); // weakmap 弱引用   key必须是对象，如果key没有被引用可以被自动销毁\r\n\r\nfunction createReactiveObject(target: object) { \r\n    // 先默认认为这个target已经是代理过的属性了\r\n    if ((target as any)[ReactiveFlags.IS_REACTIVE]) {\r\n        return target\r\n    }\r\n    // reactiveApi 只针对对象才可以 \r\n    if (!isObject(target)) {\r\n        return target\r\n    }\r\n    const exisitingProxy = reactiveMap.get(target); // 如果缓存中有 直接使用上次代理的结果\r\n    if (exisitingProxy) {\r\n        return exisitingProxy\r\n    }\r\n    const proxy = new Proxy(target, mutableHandlers); // 当用户获取属性 或者更改属性的时候 我能劫持到\r\n    reactiveMap.set(target, proxy); // 将原对象和生成的代理对象 做一个映射表\r\n\r\n    return proxy; // 返回代理\r\n}\r\n\r\nexport function reactive(target: object) {\r\n    return createReactiveObject(target)\r\n}\r\n\r\n// readonly shallowReactive shallowReadnly \r\n// export function readonly(){\r\n// }\r\n// export function shallowReactive(){\r\n// }\r\n// export function shallowReadnly(){\r\n// }\r\n"],"names":[],"mappings":";;;aAGgB,MAAM;IAEtB;;aCLgB,QAAQ,CAAC,KAAc;QACnC,OAAO,OAAO,KAAK,KAAK,QAAQ,IAAI,KAAK,KAAK,IAAI,CAAA;IACtD;;ICIA,MAAM,eAAe,GAAmC;QACpD,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ;YACrB,IAAI,GAAG,yCAAgC;gBACnC,OAAO,IAAI,CAAC;aACf;;YAED,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;YAC/C,OAAO,GAAG,CAAC;SACd;QACD,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ;;YAG5B,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;YACtD,OAAO,GAAG,CAAC;SACd;KACJ,CAAA;IACD;IACA,MAAM,WAAW,GAAG,IAAI,OAAO,EAAE,CAAC;IAElC,SAAS,oBAAoB,CAAC,MAAc;;QAExC,IAAK,MAAc,oCAA2B,EAAE;YAC5C,OAAO,MAAM,CAAA;SAChB;;QAED,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;YACnB,OAAO,MAAM,CAAA;SAChB;QACD,MAAM,cAAc,GAAG,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAC/C,IAAI,cAAc,EAAE;YAChB,OAAO,cAAc,CAAA;SACxB;QACD,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC;QACjD,WAAW,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;QAE/B,OAAO,KAAK,CAAC;IACjB,CAAC;aAEe,QAAQ,CAAC,MAAc;QACnC,OAAO,oBAAoB,CAAC,MAAM,CAAC,CAAA;IACvC,CAAC;IAED;IACA;IACA;IACA;IACA;IACA;IACA;;;;;;;;;;;;;"}